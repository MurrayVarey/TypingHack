<!DOCTYPE html>
<html>
<body>

<h1>Typing Blitz</h1>

<div class="typingContainer">
  <form>
    <label for="typingArea">Type Here</label>
    <input type="text" id="typingArea" name="typingArea" required>
  </form>
  <p>Delete the baddies. Don't get Gran!</p>
  <p id="writingArea">Hint: Use Ctrl + Delete to delete whole words!</p>
  <p id="scoreArea">Score: 0</p>
</div>

<div class="timerContainer">
  <button onclick="onStartGame()">Start Game</button>
  <p id="timerText"></p>
</div>

<script>
var typingInput = document.getElementById("typingArea");

var baddieString = "Baddie";
var granString = "Gran";

var startingBaddieCount = 1000;
var startingGranCount = 500;

var score = 0;
typingArea.onkeyup = function()
{ 
  var baddiesGone = startingBaddieCount - getBaddieCount();
  var gransGone = startingGranCount - getGranCount();
  score = baddiesGone - 5 * gransGone;
    
  document.getElementById("scoreArea").innerHTML = "Score: " + score;
}

function getBaddieCount()
{
  return getCharacterCount(baddieString);
}

function getGranCount()
{
  return getCharacterCount(granString);
}

function getCharacterCount(characterString)
{
  var count = 0;
  var tokens = document.getElementById("typingArea").value.split(" ");
  for(var iToken = 0; iToken < tokens.length; ++iToken)
  {
    if (tokens[iToken] == characterString)
    {
      ++count;
    }
  }
  return count;
}

function initGame()
{
  score = 0;
  var text = document.getElementById("typingArea");
  text.value = "";

  var totalCharacters = startingBaddieCount + startingGranCount;
  for (var i = 0; i < totalCharacters; ++i)
  {
    if ((i % 3) == 2)
    {
      text.value += granString;
    }
    else
    {
      text.value += baddieString;
    }

    // Add random number of spaces to create a scrolling effect of the text.
    var nSpaces = 1 + Math.floor(Math.random() * 8);
    for (var iSpace = 0; iSpace < nSpaces; ++iSpace)
    {
      text.value += " ";
    }
  }
}

var countDownTime = 15;

function onStartGame()
{
  var start = Date.now(); 
  var diff; 
  var seconds;

  initGame();

  function countdown()
  {
    // | 0 converts to integer. Try parseInt()?
    diff = countDownTime - (((Date.now() - start) / 1000) | 0);

    seconds = (diff % 60) | 0;

    if (seconds < 0)
    {
      seconds = 0;
    }

    document.getElementById("timerText").innerHTML = seconds + "s";
  }

  countdown();
  setInterval(countdown, 1000);
  
}

</script>

</body>
</html>